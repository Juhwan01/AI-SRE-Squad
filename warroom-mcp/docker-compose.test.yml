version: '3.8'

services:
  # Nginx web server for testing
  test-nginx:
    image: nginx:alpine
    container_name: test-nginx
    ports:
      - "8081:80"
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 10s
    restart: unless-stopped

  # Simple web app (httpd)
  test-httpd:
    image: httpd:alpine
    container_name: test-httpd
    ports:
      - "8082:80"
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 10s
    restart: unless-stopped

  # Redis for testing
  test-redis:
    image: redis:alpine
    container_name: test-redis
    ports:
      - "6379:6379"
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 10s
    restart: unless-stopped

  # PostgreSQL for testing
  test-postgres:
    image: postgres:alpine
    container_name: test-postgres
    environment:
      POSTGRES_PASSWORD: testpassword
      POSTGRES_USER: testuser
      POSTGRES_DB: testdb
    ports:
      - "5432:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U testuser"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 10s
    restart: unless-stopped

  # A container that will intentionally fail for chaos testing
  test-failing:
    image: alpine:latest
    container_name: test-failing
    command: sh -c "echo 'This container will exit immediately for testing'; exit 1"
    restart: "no"
